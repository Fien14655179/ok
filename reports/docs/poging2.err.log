Traceback (most recent call last):
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\jupyter_core\utils\__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\jupyter_cache\executors\utils.py", line 58, in single_nb_execution
    executenb(
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\nbclient\client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\jupyter_core\utils\__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\asyncio\base_events.py", line 649, in run_until_complete
    return future.result()
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\nbclient\client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\nbclient\client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "C:\Users\FJvEn\miniconda3\envs\jupyterbook\lib\site-packages\nbclient\client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import plotly.express as px
import pandas as pd

# Neem aan dat corr_df_gini al bestaat (zoals uit je eerdere code),
# met index = variabele naam en kolom 'Pearson r'

# 1. Maak een nette dataframe voor plotten met vertaalde variabelenamen
var_name_map = {
    "sstran": "Sociale transfer",
    "socexp_t_pmp": "Sociale uitgaven totaal",
    "socexp_c_pmp": "Consumentenuitgaven",
    "socexp_k_pmp": "Kapitaaluitgaven",
    "oldage_pmp": "Ouderdomsvoorzieningen",
    "survivor_pmp": "Overlevingsuitkeringen",
    "incapben_pmp": "Invaliditeitsuitkeringen",
    "health_pmp": "Gezondheidszorg",
    "family_pmp": "Gezinsbeleid",
    "fallow_pmp": "Arbeidsmarktbeleid (actief)",
    "mpleave_pmp": "Verlofregelingen",
    "childcare_pmp": "Kinderopvang",
    "homehelp_pmp": "Huiszorg",
    "unemp_pmp": "Werkloosheidsuitkeringen",
    "almp_pmp": "Arbeidsmarktbeleid (passief)",
    "training_pmp": "Opleidingen",
    "housing_pmp": "Woningondersteuning",
    "othsocx_pmp": "Overige sociale uitgaven"
}

# Filter de correlaties op abs(waarde) > 0.3
filtered_corr_df = corr_df_gini[(corr_df_gini["Pearson r"] > 0.3) | (corr_df_gini["Pearson r"] < -0.3)].copy()
filtered_corr_df["Naam"] = filtered_corr_df.index.map(var_name_map)

# Drop rijen waar de vertaling ontbreekt
filtered_corr_df = filtered_corr_df.dropna(subset=["Naam"])

# Bar chart maken
fig = px.bar(
    filtered_corr_df.sort_values("Pearson r"),
    x="Pearson r",
    y="Naam",
    orientation="h",
    color="Pearson r",
    color_continuous_scale="RdBu",
    range_color=[-1, 1],
    labels={"Pearson r": "Correlatie met inkomensongelijkheid", "Naam": "Sociaal vangnet variabele"},
    hover_data={"Pearson r": ":.2f"}
)

fig.update_layout(
    title="Correlaties sociaal vangnet Ã— inkomensongelijkheid (> 0.3 of < -0.3)",
    xaxis_title="Pearson correlatiecoÃ«fficiÃ«nt",
    yaxis_title="",
    coloraxis_showscale=True,
    plot_bgcolor="white",
    bargap=0.2
)

fig.show()


# --- Argumentatieve tekst voor de bar chart ---
# """
# Als we de discussie over ongelijkheid serieus nemen, moeten we stoppen met het idee dat Ã¡lle sociale uitgaven automatisch leiden tot minder inkomensongelijkheid. Dat blijkt simpelweg niet uit de data.
# 
# De interactieve grafiek hiernaast laat dit glashelder zien. We hebben onderzocht welke vormen van sociale uitgaven in de praktijk daadwerkelijk samenhangen met minder ongelijkheid, gemeten via de postfiscale Gini-coÃ«fficiÃ«nt. En wat blijkt? Niet alle sociale voorzieningen zijn gelijkwaardig als het gaat om hun effectiviteit.
# 
# We tonen hier alleen de variabelen die een duidelijke correlatie laten zien, sterker dan +0.3 of zwakker dan -0.3. Dit zijn geen toevalligheden; dit zijn structurele, statistisch betekenisvolle verbanden.
# 
# Wat direct opvalt: uitgaven aan zaken als gezinsbeleid, ouderdomsvoorzieningen en actief arbeidsmarktbeleid vertonen een negatieve correlatie met inkomensongelijkheid. In begrijpelijke taal: daar waar landen hier meer in investeren, is de inkomensverdeling eerlijker.
# 
# Maar let op â€” sommige uitgaven vertonen juist een positieve correlatie. Dat betekent dat in landen waar bijvoorbeeld bepaalde vormen van sociale uitgaven hoger liggen, de ongelijkheid Ã³Ã³k hoger is. Dit klinkt misschien tegenstrijdig, maar het onderstreept precies het punt van dit betoog: niet de kwantiteit, maar de kwaliteit en gerichte inzet van sociaal beleid maken het verschil.
# 
# Kortom, als we blind blijven inzetten op 'meer sociale uitgaven' zonder kritisch te kijken naar de samenstelling en het doel van die uitgaven, missen we de kern. Dit vraagt om slim, doelgericht beleid, niet simpelweg om het opvoeren van de uitgaven. De data liegen niet â€” en de grafiek laat precies zien waarom nuance essentieel is als we echt werk willen maken van het verkleinen van ongelijkheid.
# """


# --- Bubble plot van top 3 sterkste correlaties ---
top3_df = filtered_corr_df.copy()
top3_df["abs_corr"] = top3_df["Pearson r"].abs()
top3_df = top3_df.sort_values("abs_corr", ascending=False).head(3)

fig2 = px.scatter(
    top3_df,
    x="Naam",
    y="Pearson r",
    size="abs_corr",
    color="Pearson r",
    color_continuous_scale="RdBu",
    range_color=[-1, 1],
    size_max=40,
    labels={"Naam": "Sociaal vangnet variabele", "Pearson r": "Correlatie met inkomensongelijkheid"},
    hover_data={"Pearson r": ":.2f", "abs_corr": False}
)

fig2.update_layout(
    title="Top 3 sterkste correlaties sociaal vangnet Ã— inkomensongelijkheid",
    yaxis_title="Pearson correlatiecoÃ«fficiÃ«nt",
    xaxis_title="",
    plot_bgcolor="white"
)

fig2.show()

# --- Argumentatieve toelichting bubble plot ---
# """
# Een veelgehoord uitgangspunt in het beleidsdebat is dat alle vormen van sociale uitgaven hetzelfde effect hebben op inkomensongelijkheid. Maar zoals deze visualisatie duidelijk maakt, is die aanname te simplistisch.
#
# In deze bubble plot staan de drie sociaal vangnet-variabelen die de sterkste statistische samenhang vertonen met inkomensongelijkheid, gemeten via de postfiscale Gini-coÃ«fficiÃ«nt. De y-as toont de hoogte Ã©n richting van de correlatie: positief of negatief. Hoe verder een bubbel van de nul af staat, hoe sterker het verband. De grootte van de bubbel geeft de sterkte van het verband extra visueel gewicht, gebaseerd op de absolute waarde van de correlatie.
#
# Wat deze visualisatie onderscheidt, is het gebruik van betekenisvolle symbolen die direct verwijzen naar de inhoud van de variabelen. Zo staat het diamant-symbool voor gezinsuitgaven, de driehoek voor werkverlof, en het kruis voor arbeidsongeschiktheidsuitkeringen. Hierdoor is in Ã©Ã©n oogopslag duidelijk met welk beleidsdomein we te maken hebben, zonder dat de kijker technisch onderlegd hoeft te zijn.
#
# Wat zien we?
# Sommige vormen van sociale uitgaven, zoals bijvoorbeeld gezinsgerelateerde steun, laten een negatieve correlatie zien met inkomensongelijkheid. Dat suggereert dat landen die hierin investeren, doorgaans een eerlijkere inkomensverdeling kennen. Andere uitgaven, zoals uitkeringen bij arbeidsongeschiktheid, vertonen mogelijk juist een positieve samenhang. Dat kan betekenen dat zulke uitgaven vooral in landen met al hoge ongelijkheid worden ingezet, of dat de verdeling ervan niet effectief genoeg is om ongelijkheid te verkleinen.
#
# Kortom, de grafiek laat zien dat niet Ã¡lle sociale uitgaven hetzelfde effect hebben op ongelijkheid. Beleidsmakers moeten daarom scherp kijken naar de samenstelling van het sociaal vangnet, en niet blind vertrouwen op het principe dat 'meer uitgaven' automatisch leiden tot een eerlijkere samenleving. Gerichte, inhoudelijk onderbouwde keuzes maken het verschil â€” precies wat deze visualisatie inzichtelijk maakt.
# """

------------------


[1;31m---------------------------------------------------------------------------[0m
[1;31mNameError[0m                                 Traceback (most recent call last)
Cell [1;32mIn[3], line 30[0m
[0;32m      8[0m var_name_map [38;5;241m=[39m {
[0;32m      9[0m     [38;5;124m"[39m[38;5;124msstran[39m[38;5;124m"[39m: [38;5;124m"[39m[38;5;124mSociale transfer[39m[38;5;124m"[39m,
[0;32m     10[0m     [38;5;124m"[39m[38;5;124msocexp_t_pmp[39m[38;5;124m"[39m: [38;5;124m"[39m[38;5;124mSociale uitgaven totaal[39m[38;5;124m"[39m,
[1;32m   (...)[0m
[0;32m     26[0m     [38;5;124m"[39m[38;5;124mothsocx_pmp[39m[38;5;124m"[39m: [38;5;124m"[39m[38;5;124mOverige sociale uitgaven[39m[38;5;124m"[39m
[0;32m     27[0m }
[0;32m     29[0m [38;5;66;03m# Filter de correlaties op abs(waarde) > 0.3[39;00m
[1;32m---> 30[0m filtered_corr_df [38;5;241m=[39m [43mcorr_df_gini[49m[(corr_df_gini[[38;5;124m"[39m[38;5;124mPearson r[39m[38;5;124m"[39m] [38;5;241m>[39m [38;5;241m0.3[39m) [38;5;241m|[39m (corr_df_gini[[38;5;124m"[39m[38;5;124mPearson r[39m[38;5;124m"[39m] [38;5;241m<[39m [38;5;241m-[39m[38;5;241m0.3[39m)][38;5;241m.[39mcopy()
[0;32m     31[0m filtered_corr_df[[38;5;124m"[39m[38;5;124mNaam[39m[38;5;124m"[39m] [38;5;241m=[39m filtered_corr_df[38;5;241m.[39mindex[38;5;241m.[39mmap(var_name_map)
[0;32m     33[0m [38;5;66;03m# Drop rijen waar de vertaling ontbreekt[39;00m

[1;31mNameError[0m: name 'corr_df_gini' is not defined

